<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="Content-Security-Policy" content="script-src 'self' 'unsafe-inline' https://cdnjs.cloudflare.com; style-src 'self' 'unsafe-inline'; img-src 'self' data:;">
        <link rel="icon" type="image/x-icon" href="/assets/img/favicon.png">
        <link rel="stylesheet" type="text/css" href="./style/pinform.css">
        <title>SkyPass Manager</title>
    </head>
    <body>
        <div id="first-form-div">
            <img src="./assets/img/lock.png" id="lock-image" alt="Lock Image"/><br/>
            <h2 id="first-pin-text"><i>Start by creating a PIN combination</i></h2><br/>
            <form id="first-pin-form" action="index.html">
                <label for="first-pin" id="first-pin" name="firstpin">Set your PIN</label><br/>
                <input type="number" id="pin-input" name="pininput" required minlength="4" maxlength="6"><br/>
                <label for="verify-pin" id="verify-pin" name="verifypin">Verify the PIN</label><br/>
                <input type="number" id="vpin-input" name="vpininput" required><br/>
                <input type="submit" id="submit-pin" value="OK">
            </form>
        </div>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
        <script>
            const { ipcRenderer } = window;

            const firstPinForm = document.getElementById('first-pin-form');

            firstPinForm.addEventListener('submit', function(event) {
                event.preventDefault();
                const pin = document.getElementById('pin-input').value;

                const encryptedPin = CryptoJS.AES.encrypt(pin, 'secret-key').toString();

                ipcRenderer.send('save-pin', encryptedPin);
            });

            /*ipcRenderer.on('pin-save-status', (event, status) => {
                if(status.success) {
                    console.log('PIN stored successfully!');
                }
                else {
                    console.log('Error saving pin: ', status.error);
                }
            });*/
        </script>
    </body>
</html>